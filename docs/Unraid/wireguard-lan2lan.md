---
title: Lan2Lan
description: 
published: true
date: 2025-12-01T04:40:37.491Z
tags: 
editor: markdown
dateCreated: 2024-09-29T14:38:48.718Z
---

# Lan2Lan 访问



> 实现局域网之间的互相访问

## 准备工作，先规划自己的网络，示例如下



yaml

```yaml
01020304050607080910111213141516# 家中网络信息
Network1: 192.168.1.0/24
Router1:  192.168.1.1
Unraid1:  192.168.1.2
Endpoint1 DNS: 公网IP1或者域名1
Endpoint1 Port: 52821
# 公司网络信息
Network2: 192.168.123.0/24
Router2:  192.168.123.1
Unraid2:  192.168.123.2
Endpoint2 DNS: 公网IP1或者域名12
Endpoint2 Port: 52820
# VPN隧道网络信息，这个子网随便换，不冲突即可
VPN Tunnel: 192.168.11.0/24
Unraid1 tunnel IP: 192.168.11.1
Unraid2 tunnel IP: 192.168.11.2
```

### 注意事项

- 请注意，网络 1 和网络 2 网段必须不一样，网段相同会造成无法访问。例如，不能连接两个都使用 192.168.0.0/24 子网的网络。
- 尽量选择一个没有其他节点的通道上进行 Lan2Lan 通信，这样在你关闭 Lan2Lan 时不会影响其他节点的通信。
- 就目前国内网络环境来说，最好的选择就是 DDNS 解析域名，本文以 V4 网络为例，V6 网络只需要你的两个域名解析到公网即可，设置完成后你完全可以在 V6 的隧道中使用 V4 地址访问你的各种服务。

## 大佬可以直接看这个图，然后设置静态路由即可

![image-1669634218023](https://img.ptools.fun/blog/image-1669634218023.png)


## 局域网 1 设置

### unraid1 设置

#### 隧道设置

- 创建一个名为 “Network1-Network2” 的新隧道。不要将对等体添加到现有隧道，最好是将其作为单独的隧道，这样您就可以轻松将其关闭，而不会影响其他 WireGuard 连接。

- 切换到高级模式

- 单击 “生成密钥对”。这些是 Unraid1 的私钥和公钥，稍后您将需要它们。

- 将 “本地隧道网络池” 设置为您在上面选择的 “VPN 隧道”

- 从上面将 “本地隧道地址” 设置为 “Unraid1 隧道 IP”

- 将 “本地终结点” 设置为上面定义的 “终结点 1 DNS” 和 “终结点 1 端口”

- 点击应用。

  ![image-1669632102673](https://img.ptools.fun/blog/image-1669632102673.png)

> 密钥请自行生成，我就不展示了，生成之后的密钥记下来，后面要用。

#### 节点设置

- 单击添加对等
- 将其命名为 “Unraid2”
- 选择 “局域网到局域网访问”
- 单击 “生成密钥对”。这些是 Unraid2 的私钥和公钥，稍后您将需要它们。
- 点击 “生成密钥”。这是预共享密钥，稍后需要用到它。
- 将 “对等隧道地址” 设置为上面定义的 “Unraid2 隧道 IP”
- 将 “对等端点” 设置为上面定义的 “端点 2 DNS” 和 “端点 2 端口”
- 将 “对等允许的 IP” 设置为上面定义的 “VPN 隧道” 和 “网络 2”，中间加逗号。即 “192.168.11.0/24， 192.168.123.0/24”
- 点击应用。
- 启动隧道

![image-1669632376376](https://img.ptools.fun/blog/image-1669632376376.png)



### 路由器 1 设置

- 如果禁用了 UPnP，请为指向 “Unraid1” 的 “终结点 1 端口”（UDP） 设置端口转发
- 为所有通过 “Unraid1” 路由的 “Network2” 设置静态路由。请注意，如果您的路由器要求子网掩码，则 255.255.255.0 相当于 /24。
- 为 “VPN 隧道” 设置第二个静态路由，该路由也通过 “Unraid1” 路由。



![image-1669632484642](https://img.ptools.fun/blog/image-1669632484642.png)

> 这里是关键点，两个局域网之间的访问关键就在于这个静态路由，所有的网络访问都通过静态路由转发

## 局域网 2 设置

### unraid2 设置

#### 隧道设置

- 创建一个名为 “网络 2 - 网络 1” 的新隧道。
- 切换到高级模式
- 复制您在上面确定的 Unraid2 的私钥和公钥。注意使用正确的键，否则这些都不起作用。
- 将 “本地隧道网络池” 设置为您在上面选择的 “VPN 隧道”
- 从上面将 “本地隧道地址” 设置为 “Unraid2 隧道 IP”。
- 将 “本地终结点” 设置为上面定义的 “终结点 2 DNS” 和 “终结点 2 端口”
- 点击应用。

![image-1669632652162](https://img.ptools.fun/blog/image-1669632652162.png)

#### 节点设置

- 单击添加对等
- 将其命名为 “Unraid1”
- 选择 “局域网到局域网访问”
- 复制您在上面确定的 Unraid1 的私钥和公钥
- 从上面复制预共享密钥
- 将 “对等隧道地址” 设置为上面定义的 “Unraid1 隧道 IP”
- 将 “对等端点” 设置为上面定义的 “端点 1 DNS” 和 “端点 1 端口”
- 将 “对等允许的 IP” 设置为上面定义的 “VPN 隧道” 和 “网络 1”，中间加逗号。即 “192.168.11.0/24， 192.168.1.0/24”
- 点击应用。
- 启动隧道

![image-1669632854037](https://img.ptools.fun/blog/image-1669632854037.png)

### 路由器 2 设置

- 如果禁用了 UPnP，请为指向 “Unraid2” 的 “终结点 2 端口”（UDP） 设置端口转发
- 为通过 “Unraid2” 路由的所有 “网络 1” 设置静态路由。
- 为 “VPN 隧道” 设置第二个静态路由，该路由也通过 “Unraid2” 路由。

![image-1669633053169](https://img.ptools.fun/blog/image-1669633053169.png)

## 注意

这里面有几个关键点要注意:  

> 1. 如果你使用的 V6 公网和域名，IP 模式一定要选择 v4+v6 模式两边的端口一定要映射，映射协议一定要是 UDP 或者至少包含 UDP，这点一定要注意，说多了都是泪

> 2.  静态路由填写的时候选择接口一定要选择 LAN，我第一次按照自己的理解来填写，结果整整浪费了一个上午

> 3. 整个建构简单来说就是 U2 的隧道填写 U1 的 Peer 节点的信息，除了域名，Peer 节点填写的 U1 的隧道的信息，除了域名

> 4. U1 的 Peer 节点的允许 IP 填写 U2 的网段和隧道网段，U2 的填写 U1 的网段和隧道的网段

## 祝你一切顺利。